<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Family Planner – Luvo</title>
<style>
body {
    margin:0; 
    font-family: Arial, sans-serif; 
    background:#c9f0e8;
}

/* --- New Header Styling --- */
.app-header {
    background: #c9f0e8; 
    padding: 40px 20px 0 20px;
    text-align: center;
}
.app-header h1 {
    font-size: 3em;
    font-weight: bold;
    color: #000;
    margin: 0 0 5px 0;
}
.app-header p {
    font-size: 1.2em;
    color: #333;
    margin: 0;
    padding-bottom: 30px;
}
/* ------------------------- */

.main {
    display: flex;
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px 20px 20px; 
    gap: 20px;
    align-items: flex-start;
}
.left-column { flex:2; display: flex; flex-direction: column; gap: 20px; }
.right-column { flex:1; display: flex; flex-direction: column; }

.card {
    background: white;
    border-radius: 14px;
    padding: 25px;
    box-sizing: border-box;
    min-height: 200px;
}
.card h2 { margin-top: 0; font-size: 22px; text-align:center; }

.create {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.chart {
    position: relative;
    width: 140px;
    height: 140px;
    margin: 40px 0 25px 0;
}
.circle {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 12px solid #c9e4e6;
    border-top-color: #004f63;
}
.total-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    text-align: center;
}

.create form {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    width: 70%;
}

input {
    width: 100%;
    padding: 10px;
    border: 1px solid #dcdcdc;
    border-radius: 6px;
}


.set-btn, .view-btn, .delete-btn {
    background: #0b637b;
    color: white;
    padding: 8px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    width: auto;
}


.full-width-section {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px 40px 20px; 
}

.trip-card {
    background: white; 
    border-radius: 14px; 
    box-sizing: border-box; 
    padding: 15px 25px; 
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top:20px;
    min-height: auto; 
}

.trip-info {
    display: flex;
    align-items: center;
    gap: 20px; 
}

.trip-info strong {
    font-size: 1.1em;
}

label {
    display:inline-block;
    width:100px;
}
.budget input { width: calc(100% - 110px); } 
.budget div { margin-bottom: 10px; display:flex; align-items:center; }

@media(max-width:900px){
    .main{ flex-direction: column; }
    .right-column{ width:100%; }
    .full-width-section{ padding-top: 20px; }
}
</style>
</head>

<body>

<header class="app-header">
    <h1>Family Planner</h1>
    <p>Track budgets and collaborate with family.</p>
</header>

<section class="main">
    <div class="left-column">
        <div class="card create" id="createCard">
            <h2>Create New Plan</h2>
            <div class="chart">
                <div class="circle"></div>
                <p class="total-text" id="totalBudget">Total<br>$0.00</p>
            </div>
            <form id="addTripForm">
                <input type="text" name="tripName" placeholder="Trip Name" required>
                <input type="number" name="budget" placeholder="Budget" step="0.01">
                <button class="set-btn" type="submit">Add Trip</button>
            </form>
        </div>
    </div>

    <div class="right-column">
        <div class="card budget" id="budgetCard">
            <h2>Budget Overview</h2>
            <form id="budgetForm">
                <input type="hidden" name="index">
                <div><label>Flights:</label><input type="number" name="flights" value="0"></div>
                <div><label>Lodging:</label><input type="number" name="lodging" value="0"></div>
                <div><label>Food:</label><input type="number" name="food" value="0"></div>
                <div><label>Activities:</label><input type="number" name="activities" value="0"></div>
                <button class="set-btn" type="submit">Set Budget</button>
            </form>
        </div>
    </div>
</section>

<div class="full-width-section">
    <div id="tripList"></div>
</div>

</body>
</html>





<script>
const apiBase = 'http://localhost:8080/family-planner/api';

// Load all trips
async function loadTrips() {
    try {
        const res = await fetch(apiBase);
        const trips = await res.json();
        renderTrips(trips);
    } catch (err) {
        console.error('Error loading trips:', err);
    }
}

// Render trips on screen
function renderTrips(trips) {
    const tripList = document.getElementById('tripList');
    tripList.innerHTML = '';

    trips.forEach((trip, index) => {
        const card = document.createElement('div');
        card.className = 'card trip-card';

        card.innerHTML = `
            <div class="trip-info">
                <div class="trip-title">${trip.tripName}</div>
                <div class="trip-sub">
                    Status: <strong>${trip.status}</strong> | 
                    Budget: <strong>$${trip.budget.toFixed(2)}</strong>
                </div>
            </div>

            <div class="button-group">
                <button class="view-btn">View</button>
                <button class="delete-btn">Delete</button>
            </div>
        `;

        tripList.appendChild(card);

        // VIEW button
        card.querySelector('.view-btn').addEventListener('click', () => {
            document.querySelector('#budgetForm input[name="index"]').value = index;
            document.querySelector('#budgetForm input[name="flights"]').value = trip.flights;
            document.querySelector('#budgetForm input[name="lodging"]').value = trip.lodging;
            document.querySelector('#budgetForm input[name="food"]').value = trip.food;
            document.querySelector('#budgetForm input[name="activities"]').value = trip.activities;
        });

        // DELETE button
        card.querySelector('.delete-btn').addEventListener('click', async () => {
            try {
                await fetch(`${apiBase}/${index}`, { method: 'DELETE' });
                alert("Trip deleted!");
                loadTrips();
            } catch (err) {
                console.error('Error deleting trip:', err);
            }
        });
    });

    // Update total budget circle
    const total = trips.reduce((sum, t) => sum + (t.budget || 0), 0);
    document.getElementById('totalBudget').innerHTML =
        `Total<br>$${total.toFixed(2)}`;
}

// Add new trip
document.querySelector('#addTripForm').addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;

    const tripName = form.tripName.value;
    const budget = parseFloat(form.budget.value) || 0;

    if (tripName) {
        try {
            await fetch(apiBase, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    tripName,
                    status: 'Planning',
                    budget,
                    flights: 0,
                    lodging: 0,
                    food: 0,
                    activities: 0
                })
            });
            form.reset();
            loadTrips();
        } catch (err) {
            console.error('Error adding trip:', err);
        }
    }
});

// Update budget + alerts + status change
document.querySelector('#budgetForm').addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;
    const index = form.index.value;

    const flights = parseFloat(form.flights.value) || 0;
    const lodging = parseFloat(form.lodging.value) || 0;
    const food = parseFloat(form.food.value) || 0;
    const activities = parseFloat(form.activities.value) || 0;

    const totalSpent = flights + lodging + food + activities;

    const trips = await (await fetch(apiBase)).json();
    const tripBudget = trips[index].budget;

    let newStatus = totalSpent > tripBudget ? "Locked" : "Planning";

    try {
        await fetch(`${apiBase}/${index}/budget`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                flights,
                lodging,
                food,
                activities,
                status: newStatus
            })
        });

        if (totalSpent > tripBudget) {
            alert("⚠️ Budget Exceeded!");
        } else {
            alert("Budget Updated Successfully!");
        }

        loadTrips();

    } catch (err) {
        console.error('Error updating budget:', err);
    }
});

// Initial load
loadTrips();
</script>

</body>
</html>
